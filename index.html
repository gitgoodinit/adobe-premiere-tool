<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Media Tools Pro</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <!-- Enhanced UI Styles -->
  <link rel="stylesheet" href="./src/ui/enhanced-silence-results.css">
  <!-- CEP Library -->
  <script src="./CSInterface.js"></script>
</head>

<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="header-left">
          <i class="fas fa-waveform-lines"></i>
          <h1>Media Tools Pro</h1>
          <span class="version-badge">Phase 1 - CEP</span>
        </div>
        <div class="header-controls">
          <div class="connection-status" id="connectionStatus">
            <span class="status-dot"></span>
            <span class="status-text">Ready</span>
          </div>
          <button class="logs-toggle-btn" id="toggleLogs" title="Toggle Debug Console">
            <i class="fas fa-terminal"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- Enhanced UI Toggle Button -->
    <div class="enhanced-ui-toggle" id="enhancedUIToggle" style="display: none;">
      <button class="action-btn secondary" id="toggleEnhancedUI">
        <i class="fas fa-eye"></i> Show Enhanced UI
      </button>
    </div>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Enhanced Project Information -->
      <section class="project-info-panel">
        <div class="panel-header">
          <h2><i class="fas fa-film"></i> Current Project</h2>
        </div>

        <div class="project-grid">
          <div class="project-main-info">
            <div class="project-title">
              <h3 id="projectName">No Project Loaded</h3>
              <span class="project-path" id="projectPath">/path/to/project.prproj</span>
            </div>
            <div class="project-stats">
              <div class="stat-item">
                <span class="stat-label">Sequence:</span>
                <span class="stat-value" id="sequenceName">None</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Duration:</span>
                <span class="stat-value" id="sequenceDuration">0:00</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Frame Rate:</span>
                <span class="stat-value" id="frameRate">23.976 fps</span>
              </div>
            </div>
          </div>

          <div class="project-media-info">
            <div class="media-item">
              <i class="fas fa-video"></i>
              <div class="media-details">
                <span class="media-name" id="videoFileName">shortez.mp4</span>
                <span class="media-specs" id="videoSpecs">1920x1080, H.264</span>
              </div>
            </div>
            <div class="track-summary">
              <div class="track-count">
                <i class="fas fa-volume-up"></i>
                <span id="audioTrackCount">0</span> Audio Tracks
              </div>
              <div class="track-count">
                <i class="fas fa-film"></i>
                <span id="videoTrackCount">0</span> Video Tracks
              </div>
              <div class="selected-info">
                <i class="fas fa-mouse-pointer"></i>
                <span id="selectedClipsCount">0</span> Selected
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Media Loading Section (Moved Above Phase 1) -->
      <section class="media-loading-section">
        <div class="feature-actions">
          <button class="action-btn secondary" id="extractAudio">
            <i class="fas fa-download"></i> Load Media
          </button>
        </div>

        <!-- Video Player Section -->
        <div class="video-player-section" id="videoPlayerSection" style="display: none;">
          <div class="video-player-header">
            <h4><i class="fas fa-film"></i> Video Player</h4>
            <span class="video-info" id="videoInfo">No video loaded</span>
          </div>
          <div class="video-player-controls">
            <video id="videoPlayer" controls style="width: 100%; max-height: 240px; background: #000;">
              Your browser does not support the video element.
            </video>
          </div>
        </div>

        <!-- Dual Audio Player Section -->
        <div class="dual-audio-section" id="audioPlayerSection" style="display: none;">
          <!-- Original Audio Track -->
          <div class="audio-track-container original-track">
            <div class="track-header">
              <h4><i class="fas fa-music"></i> Original Audio</h4>
              <div class="track-info">
                <span class="audio-info" id="audioInfo">No audio loaded</span>
                <div class="track-actions">
                  <button class="mini-btn" id="extractVideoAudio" title="Extract Audio from Video">
                    <i class="fas fa-extract"></i>
                  </button>
                  <button class="mini-btn" id="loadAudioFile" title="Load Audio File">
                    <i class="fas fa-folder-open"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="audio-player-controls original-controls">
              <audio id="audioPlayer" controls style="width: 100%; margin-bottom: 8px;">
                Your browser does not support the audio element.
              </audio>

              <div class="waveform-container" style="position: relative;">
                <canvas id="waveformCanvas" height="80"></canvas>
                <div class="trim-handles-container" id="trimHandlesContainer">
                  <div class="trim-handle trim-in" id="trimInHandle" style="left: 0%;">
                    <div class="handle-grip"></div>
                    <div class="handle-label">IN</div>
                  </div>
                  <div class="trim-handle trim-out" id="trimOutHandle" style="left: 100%;">
                    <div class="handle-grip"></div>
                    <div class="handle-label">OUT</div>
                  </div>
                  <div class="trim-region-highlight" id="trimRegionHighlight" style="left: 0%; width: 100%;"></div>
                </div>
                <div class="waveform-footer">
                  <div class="wf-left">
                    <span id="wfCurrent">0:00</span>
                  </div>
                  <div class="wf-center">
                    <span class="trim-indicator" id="trimIndicator">Drag handles to trim</span>
                  </div>
                  <div class="wf-right">
                    <span id="wfTotal">0:00</span>
                  </div>
                </div>
              </div>

              <div class="player-buttons">
                <button class="player-btn" id="playPause">
                  <i class="fas fa-play"></i>
                </button>
                <button class="player-btn" id="stopAudio">
                  <i class="fas fa-stop"></i>
                </button>
                <button class="player-btn" id="loopToggle">
                  <i class="fas fa-redo"></i>
                </button>
                <div class="volume-control">
                  <i class="fas fa-volume-up"></i>
                  <input type="range" id="volumeSlider" min="0" max="100" value="70" class="volume-slider">
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Phase 1 Features Navigation -->
      <section class="features-nav">
        <h2><i class="fas fa-layer-group"></i> Phase 1: Core Workflow Automation (Audio-first)</h2>
        <div class="feature-tabs">
          <button class="feature-tab active" data-feature="feature1">
            <i class="fas fa-volume-mute"></i>
            <span>Silence Detection</span>
          </button>
          <button class="feature-tab" data-feature="feature2">
            <i class="fas fa-wave-square"></i>
            <span>Overlap Detection</span>
          </button>
          <button class="feature-tab" data-feature="feature3">
            <i class="fas fa-stream"></i>
            <span>Multi-Track Handling</span>
          </button>
          <button class="feature-tab" data-feature="feature4">
            <i class="fas fa-music"></i>
            <span>Rhythm & Timing</span>
          </button>
          <button class="feature-tab" data-feature="feature5">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
          </button>
        </div>
      </section>

      <!-- Feature 1: Silence Detection & Trimming -->
      <section class="feature-content active" id="feature1">
        <div class="feature-header">
          <h3>Silence Detection & Trimming</h3>
          <p>FFmpeg + Web Audio API + AI Transcript Analysis</p>
          <div class="feature-instructions">
            <i class="fas fa-info-circle"></i>
            <span>Select a clip in Premiere Pro. The selected media will auto-load here. You can also click "Load
              Media" above. Use the buttons below to analyze and process your audio.</span>
          </div>
        </div>

        <div class="feature-controls">
          <div class="control-row">
            <div class="control-group">
              <label for="silenceThreshold">Noise Threshold</label>
              <div class="slider-control">
                <input type="range" id="silenceThreshold" min="-60" max="-10" value="-30" step="1">
                <span class="slider-value" id="silenceThresholdValue">-30dB</span>
              </div>
            </div>
            <div class="control-group">
              <label for="silenceDuration">Min Duration</label>
              <div class="slider-control">
                <input type="range" id="silenceDuration" min="0.1" max="3.0" value="0.5" step="0.1">
                <span class="slider-value" id="silenceDurationValue">0.5s</span>
              </div>
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <label for="pauseThreshold">Pause Threshold (dB)</label>
              <div class="slider-control">
                <input type="range" id="pauseThreshold" min="-50" max="-15" value="-20" step="1">
                <span class="slider-value" id="pauseThresholdValue">-20dB</span>
              </div>
            </div>
            <div class="control-group">
              <label for="pauseMinDuration">Min Pause Duration (s)</label>
              <div class="slider-control">
                <input type="range" id="pauseMinDuration" min="0.1" max="2.0" value="0.3" step="0.1">
                <span class="slider-value" id="pauseMinDurationValue">0.3s</span>
              </div>
            </div>
          </div>

          <div class="method-selection">
            <label>Detection Methods:</label>
            <div class="method-checkboxes">
              <label class="checkbox-option">
                <input type="checkbox" id="useFFmpeg" checked>
                <span class="checkmark"></span>
                FFmpeg (Primary)
              </label>
              <label class="checkbox-option">
                <input type="checkbox" id="useWebAudio" checked>
                <span class="checkmark"></span>
                Web Audio API
              </label>
              <label class="checkbox-option">
                <input type="checkbox" id="useTranscript">
                <span class="checkmark"></span>
                AI Transcript
              </label>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="silence-action-buttons">
            <div class="button-row">
              <button class="action-btn primary" id="detectSilence">
                <i class="fas fa-robot"></i> Enhanced AI Silence Detection
              </button>
              <button class="action-btn secondary" id="transcribeNow" disabled>
                <i class="fas fa-file-audio"></i> Transcribe
              </button>
              <button class="action-btn secondary" id="autoTrim">
                <i class="fas fa-cut"></i> Auto Trim
              </button>
            </div>

          </div>
        </div>



        <!-- Trim & Transcription Controls -->
        <div class="trim-controls" id="trimControls">
          <div class="trim-header">
            <h4><i class="fas fa-scissors"></i> Trim & Transcribe</h4>
            <span class="trim-hint">Applies to linked audio + video</span>
          </div>
          <div class="trim-fields">
            <div class="trim-field">
              <label for="trimIn">In</label>
              <input type="text" id="trimIn" placeholder="0:00" />
              <button class="mini-btn" id="setIn" title="Set In from playhead"><i
                  class="fas fa-angle-left"></i></button>
            </div>
            <div class="trim-field">
              <label for="trimOut">Out</label>
              <input type="text" id="trimOut" placeholder="0:00" />
              <button class="mini-btn" id="setOut" title="Set Out from playhead"><i
                  class="fas fa-angle-right"></i></button>
            </div>
          </div>
          <div class="trim-actions">
            <button class="action-btn primary" id="applyTrim"><i class="fas fa-cut"></i> Apply Trim (A/V)</button>
            <button class="action-btn secondary" id="transcribeSelection"><i class="fas fa-file-audio"></i>
              Transcribe</button>
          </div>
        </div>


        <div class="results-tabs">
          <button class="tab-button active" data-tab="silence">Silence Results</button>
          <button class="tab-button" data-tab="transcript">Transcript</button>
          <button class="tab-button" data-tab="realtime">Real-time Text</button>
        </div>

        <div class="tab-content active" id="silenceTab">
          <!-- Enhanced Silence Results UI Container -->
          <div id="enhancedSilenceResultsContainer" style="display: none;">
            <!-- Enhanced UI will be loaded here -->
          </div>

          <!-- Original Results Area (fallback) -->
          <div class="results-area" id="silenceResults">
            <div class="empty-state">
              <i class="fas fa-volume-mute"></i>
              <p>Run silence detection to see results</p>
            </div>
          </div>
        </div>

        <div class="tab-content" id="transcriptTab">
          <div class="transcript-area" id="transcriptResults">
            <div class="empty-state">
              <i class="fas fa-file-text"></i>
              <p>Extract text to see transcript with timestamps</p>
            </div>
          </div>
        </div>

        <div class="tab-content" id="realtimeTab">
          <div class="realtime-text-area" id="realtimeTextArea">
            <div class="realtime-controls">
              <div class="realtime-status" id="realtimeStatus">
                <span class="status-indicator"></span>
                <span class="status-text">Ready</span>
              </div>
              <button class="realtime-toggle-btn" id="toggleRealtime" disabled>
                <i class="fas fa-play"></i> Start
              </button>
            </div>
            <div class="realtime-text-display" id="realtimeTextDisplay">
              <div class="empty-state">
                <i class="fas fa-microphone-slash"></i>
                <p>Extract audio first, then start real-time text recognition</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Feature 2: Audio Overlap Detection -->
      <section class="feature-content" id="feature2">
        <div class="feature-header">
          <h3>Audio Overlap Detection</h3>
          <p>Frequency-domain analysis + Cross-correlation algorithms</p>
        </div>

        <!-- Enhanced Main Controls Panel -->
        <div class="enhanced-feature-controls">
          
          <!-- Analysis Configuration Section -->
          <div class="controls-section" data-section="analysis">
            <div class="section-header">
              <h4><i class="fas fa-sliders-h"></i> Analysis Configuration</h4>
              <div class="section-indicator">
                <span class="indicator-dot active"></span>
                <span class="indicator-text">Ready</span>
              </div>
            </div>
            
            <div class="controls-grid">
              <div class="control-card">
                <div class="control-header">
                  <label for="overlapSensitivity">Detection Sensitivity</label>
                  <div class="control-info" title="Higher sensitivity detects more subtle overlaps">
                    <i class="fas fa-info-circle"></i>
                  </div>
                </div>
                <div class="enhanced-slider-control">
                  <div class="slider-track">
                    <input type="range" id="overlapSensitivity" min="1" max="10" value="5" step="1">
                    <div class="slider-fill"></div>
                    <div class="slider-markers">
                      <span>Low</span>
                      <span>Med</span>
                      <span>High</span>
                    </div>
                  </div>
                  <div class="slider-value-display">
                    <span class="value-badge" id="overlapSensitivityValue">5</span>
                  </div>
                </div>
              </div>

              <div class="control-card">
                <div class="control-header">
                  <label for="frequencyRange">Frequency Analysis Range</label>
                  <div class="control-info" title="Choose the frequency range to analyze">
                    <i class="fas fa-info-circle"></i>
                  </div>
                </div>
                <div class="enhanced-select">
                  <select id="frequencyRange" class="enhanced-select-input">
                    <option value="full" data-icon="fas fa-wave-square">🌊 Full Spectrum (20-20kHz)</option>
                    <option value="speech" data-icon="fas fa-microphone">🎤 Speech Range (300-3400Hz)</option>
                    <option value="music" data-icon="fas fa-music">🎵 Music Range (20-20kHz)</option>
                  </select>
                  <div class="select-arrow">
                    <i class="fas fa-chevron-down"></i>
                  </div>
                </div>
              </div>

              <div class="control-card">
                <div class="control-header">
                  <label for="fftSize">Analysis Quality (FFT Size)</label>
                  <div class="control-info" title="Higher values = better quality but slower processing">
                    <i class="fas fa-info-circle"></i>
                  </div>
                </div>
                <div class="enhanced-select">
                  <select id="fftSize" class="enhanced-select-input">
                    <option value="512">⚡ 512 (Fast)</option>
                    <option value="1024">⚖️ 1024 (Balanced)</option>
                    <option value="2048" selected>✨ 2048 (Standard)</option>
                    <option value="4096">💎 4096 (High Quality)</option>
                  </select>
                  <div class="select-arrow">
                    <i class="fas fa-chevron-down"></i>
                  </div>
                </div>
              </div>

              <div class="control-card">
                <div class="control-header">
                  <label for="analysisMode">Processing Mode</label>
                  <div class="control-info" title="How the analysis should be performed">
                    <i class="fas fa-info-circle"></i>
                  </div>
                </div>
                <div class="enhanced-select">
                  <select id="analysisMode" class="enhanced-select-input">
                    <option value="realtime">🔴 Real-time</option>
                    <option value="batch">📦 Batch Processing</option>
                    <option value="hybrid" selected>🔀 Hybrid (Recommended)</option>
                  </select>
                  <div class="select-arrow">
                    <i class="fas fa-chevron-down"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Auto-Resolution Section -->
          <div class="controls-section" data-section="resolution">
            <div class="section-header">
              <h4><i class="fas fa-magic"></i> Auto-Resolution Methods</h4>
              <div class="section-toggle">
                <label class="toggle-switch">
                  <input type="checkbox" id="enableAutoResolve" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
            
            <div class="resolution-methods">
              <div class="method-card">
                <div class="method-icon">
                  <i class="fas fa-arrows-alt-h"></i>
                </div>
                <div class="method-content">
                  <label class="enhanced-checkbox">
                    <input type="checkbox" id="clipShifting" checked>
                    <span class="checkbox-mark"></span>
                    <div class="method-info">
                      <span class="method-title">Clip Shifting</span>
                      <span class="method-description">Move overlapping clips to avoid conflicts</span>
                    </div>
                  </label>
                </div>
              </div>
              
              <div class="method-card">
                <div class="method-icon">
                  <i class="fas fa-volume-down"></i>
                </div>
                <div class="method-content">
                  <label class="enhanced-checkbox">
                    <input type="checkbox" id="audioDucking">
                    <span class="checkbox-mark"></span>
                    <div class="method-info">
                      <span class="method-title">Audio Ducking</span>
                      <span class="method-description">Lower volume of background audio</span>
                    </div>
                  </label>
                </div>
              </div>
              
              <div class="method-card">
                <div class="method-icon">
                  <i class="fas fa-cut"></i>
                </div>
                <div class="method-content">
                  <label class="enhanced-checkbox">
                    <input type="checkbox" id="layerTrimming">
                    <span class="checkbox-mark"></span>
                    <div class="method-info">
                      <span class="method-title">Layer Trimming</span>
                      <span class="method-description">Trim overlapping audio layers</span>
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Advanced Detection Section -->
          <div class="controls-section" data-section="advanced">
            <div class="section-header">
              <h4><i class="fas fa-brain"></i> AI & Advanced Detection</h4>
              <div class="ai-status" id="aiStatus">
                <span class="ai-indicator online"></span>
                <span class="ai-text">AI Ready</span>
              </div>
            </div>
            
            <div class="advanced-features">
              <div class="feature-card premium">
                <div class="feature-icon">
                  <i class="fas fa-robot"></i>
                </div>
                <div class="feature-content">
                  <label class="enhanced-checkbox">
                    <input type="checkbox" id="enableML" checked>
                    <span class="checkbox-mark"></span>
                    <div class="feature-info">
                      <span class="feature-title">Machine Learning Validation</span>
                      <span class="feature-badge">AI POWERED</span>
                    </div>
                  </label>
                </div>
              </div>
              
              <div class="feature-card">
                <div class="feature-icon">
                  <i class="fas fa-project-diagram"></i>
                </div>
                <div class="feature-content">
                  <label class="enhanced-checkbox">
                    <input type="checkbox" id="enableCrossCorrelation" checked>
                    <span class="checkbox-mark"></span>
                    <div class="feature-info">
                      <span class="feature-title">Cross-Correlation Analysis</span>
                      <span class="feature-description">Mathematical timing analysis</span>
                    </div>
                  </label>
                </div>
              </div>
              
              <div class="feature-card">
                <div class="feature-icon">
                  <i class="fas fa-wave-square"></i>
                </div>
                <div class="feature-content">
                  <label class="enhanced-checkbox">
                    <input type="checkbox" id="enableHarmonicAnalysis">
                    <span class="checkbox-mark"></span>
                    <div class="feature-info">
                      <span class="feature-title">Harmonic Analysis</span>
                      <span class="feature-description">Frequency relationship detection</span>
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Actions Section -->
          <div class="controls-section" data-section="actions">
            <div class="section-header">
              <h4><i class="fas fa-bolt"></i> Quick Actions</h4>
            </div>
            
            <div class="quick-actions">
              <div class="action-group">
                <label class="toggle-card">
                  <input type="checkbox" id="enableDemoMode">
                  <span class="toggle-card-content">
                    <div class="toggle-card-icon">
                      <i class="fas fa-flask"></i>
                    </div>
                    <div class="toggle-card-info">
                      <span class="toggle-title">Demo Mode</span>
                      <span class="toggle-description">Instant sample results</span>
                    </div>
                    <div class="toggle-switch-mini">
                      <span class="toggle-slider-mini"></span>
                    </div>
                  </span>
                </label>
              </div>
              
              <div class="test-buttons-grid">
                <button class="enhanced-test-btn" onclick="window.audioToolsPro.testOpenAIKey()">
                  <i class="fas fa-key"></i>
                  <span>Test API</span>
                </button>
                <button class="enhanced-test-btn" onclick="window.audioToolsPro.testBackgroundNoiseDetection()">
                  <i class="fas fa-robot"></i>
                  <span>Test AI</span>
                </button>
                <button class="enhanced-test-btn" onclick="window.audioToolsPro.testAudioPlayback()">
                  <i class="fas fa-play"></i>
                  <span>Test Audio</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Feature Actions -->
        <div class="enhanced-feature-actions">
          <div class="action-section primary">
            <button class="enhanced-action-btn primary" id="detectOverlaps">
              <div class="btn-icon">
                <i class="fas fa-search"></i>
              </div>
              <div class="btn-content">
                <span class="btn-title">Detect Overlaps</span>
                <span class="btn-subtitle">Analyze audio for conflicts</span>
              </div>
              <div class="btn-indicator">
                <i class="fas fa-arrow-right"></i>
              </div>
            </button>
          </div>
          
          <div class="action-section secondary">
            <button class="enhanced-action-btn secondary" id="resolveOverlaps" disabled>
              <div class="btn-icon">
                <i class="fas fa-magic"></i>
              </div>
              <div class="btn-content">
                <span class="btn-title">Auto Resolve</span>
                <span class="btn-subtitle">Fix detected issues</span>
              </div>
              <div class="btn-status" id="resolveStatus">
                <span class="status-text">Ready</span>
              </div>
            </button>
            
            <button class="enhanced-action-btn secondary" id="addOverlapMarkers">
              <div class="btn-icon">
                <i class="fas fa-map-marker-alt"></i>
              </div>
              <div class="btn-content">
                <span class="btn-title">Add Markers</span>
                <span class="btn-subtitle">Mark in timeline</span>
              </div>
            </button>
          </div>
        </div>
        
        <!-- Audio Preview Section -->
        <div class="audio-preview-section" id="audioPreviewSection" style="display: none;">
          <div class="preview-header">
            <h4><i class="fas fa-headphones"></i> Audio Preview</h4>
            <div class="preview-controls">
              <button class="preview-tab active" data-tab="original">
                <i class="fas fa-file-audio"></i> Original
              </button>
              <button class="preview-tab" data-tab="resolved" id="resolvedTab" disabled>
                <i class="fas fa-check-circle"></i> Resolved
              </button>
            </div>
          </div>
          
          <!-- Original Audio Player -->
          <div class="preview-player active" id="originalPreview">
            <div class="player-info">
              <span class="player-label">Original Audio with Overlaps</span>
              <span class="player-status" id="originalStatus">Ready</span>
            </div>
            <div class="audio-player-container">
              <audio id="originalAudioPlayer" controls class="enhanced-audio-player">
                Your browser does not support the audio element.
              </audio>
              <div class="player-timeline" id="originalTimeline">
                <canvas id="originalWaveform" height="60"></canvas>
                <div class="overlap-markers" id="originalMarkers"></div>
              </div>
            </div>
          </div>
          
          <!-- Resolved Audio Player -->
          <div class="preview-player" id="resolvedPreview">
            <div class="player-info">
              <span class="player-label">Resolved Audio (Clean)</span>
              <span class="player-status" id="resolvedStatus">Not Available</span>
            </div>
            <div class="audio-player-container">
              <audio id="resolvedAudioPlayer" controls class="enhanced-audio-player" disabled>
                Your browser does not support the audio element.
              </audio>
              <div class="player-timeline" id="resolvedTimeline">
                <canvas id="resolvedWaveform" height="60"></canvas>
                <div class="resolution-indicators" id="resolutionIndicators"></div>
              </div>
            </div>
            <div class="player-actions">
              <button class="player-action-btn" id="downloadResolved" disabled>
                <i class="fas fa-download"></i> Download Clean Audio
              </button>
              <button class="player-action-btn" id="exportToTimeline" disabled>
                <i class="fas fa-share"></i> Export to Timeline
              </button>
            </div>
          </div>
        </div>

        <!-- Enhanced Results Area -->
        <div class="enhanced-results-area" id="overlapResults">
          <div class="empty-state">
            <div class="empty-icon">
              <i class="fas fa-wave-square"></i>
            </div>
            <div class="empty-text">
              <p>No Overlap Analysis Results</p>
              <span>Click "Detect Overlaps" to analyze your audio for issues</span>
            </div>
            <div class="empty-action">
              <button class="btn-analyze-now" id="detectOverlapsAlt">
                <i class="fas fa-search"></i> Analyze Now
              </button>
            </div>
          </div>
          
          <!-- Results will be populated here -->
          <div class="results-container" id="overlapResultsContainer" style="display: none;">
            <div class="results-header">
              <div class="results-summary">
                <h4><i class="fas fa-wave-square"></i> Detected Audio Overlaps</h4>
                <div class="summary-stats">
                  <div class="stat-badge" id="totalOverlaps">0 issues</div>
                  <div class="stat-badge" id="avgSeverity">0.0 severity</div>
                  <div class="stat-badge" id="mlConfidence">0% AI confidence</div>
                </div>
              </div>
              <div class="results-actions">
                <button class="results-action-btn" id="expandAllOverlaps">
                  <i class="fas fa-expand-alt"></i> Expand All
                </button>
                <button class="results-action-btn" id="collapseAllOverlaps">
                  <i class="fas fa-compress-alt"></i> Collapse All
                </button>
              </div>
            </div>
            
            <div class="results-timeline">
              <div class="timeline-header">
                <span>Audio Timeline</span>
                <div class="zoom-controls">
                  <button class="zoom-btn" id="zoomOut" title="Zoom Out">
                    <i class="fas fa-search-minus"></i>
                  </button>
                  <button class="zoom-btn" id="zoomReset" title="Reset Zoom">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                  <button class="zoom-btn" id="zoomIn" title="Zoom In">
                    <i class="fas fa-search-plus"></i>
                  </button>
                </div>
              </div>
              <div class="timeline-visualization">
                <div class="timeline-ruler" id="timelineRuler"></div>
                <canvas id="timelineCanvas" height="80"></canvas>
                <div class="timeline-markers" id="timelineMarkers"></div>
                <div class="timeline-playhead" id="timelinePlayhead"></div>
              </div>
            </div>
            
            <!-- Results Categories -->
            <div class="results-filter">
              <div class="filter-label">Filter by Type:</div>
              <div class="filter-options">
                <label class="filter-option active">
                  <input type="checkbox" checked data-filter="all">
                  <span class="filter-text">All</span>
                  <span class="filter-count" id="filterAll">0</span>
                </label>
                <label class="filter-option">
                  <input type="checkbox" data-filter="frequency_collision">
                  <span class="filter-text">Frequency</span>
                  <span class="filter-count" id="filterFrequency">0</span>
                </label>
                <label class="filter-option">
                  <input type="checkbox" data-filter="background_noise">
                  <span class="filter-text">Background Noise</span>
                  <span class="filter-count" id="filterNoise">0</span>
                </label>
                <label class="filter-option">
                  <input type="checkbox" data-filter="cross_correlation">
                  <span class="filter-text">Timing</span>
                  <span class="filter-count" id="filterTiming">0</span>
                </label>
              </div>
            </div>
            
            <!-- Results List -->
            <div class="overlap-items" id="overlapItemsList"></div>
          </div>
        </div>
        
        <!-- Overlap Detail Panel (opens when a specific overlap is selected) -->
        <div class="overlap-detail-panel" id="overlapDetailPanel" style="display: none;">
          <div class="detail-panel-header">
            <div class="detail-title">
              <i class="fas fa-info-circle"></i>
              <span id="detailTitle">Overlap Detail</span>
            </div>
            <button class="detail-close-btn" id="closeDetailPanel">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <div class="detail-content">
            <div class="detail-properties" id="detailProperties">
              <!-- Properties will be populated dynamically -->
            </div>
            
            <div class="detail-segment-player">
              <div class="segment-header">
                <h5><i class="fas fa-play-circle"></i> Play This Segment</h5>
                <span class="segment-time" id="segmentTime">0:00 - 0:00</span>
              </div>
              
              <div class="segment-player-controls">
                <audio id="segmentPlayer" controls class="segment-audio-player"></audio>
                <div class="segment-waveform" id="segmentWaveform">
                  <canvas id="segmentWaveformCanvas" height="60"></canvas>
                </div>
              </div>
              
              <div class="segment-actions">
                <button class="segment-action-btn primary" id="resolveSegment">
                  <i class="fas fa-magic"></i> Auto-Resolve This Segment
                </button>
                <button class="segment-action-btn" id="loopSegment">
                  <i class="fas fa-sync-alt"></i> Loop
                </button>
                <button class="segment-action-btn" id="addSegmentMarker">
                  <i class="fas fa-map-marker-alt"></i> Add Marker
                </button>
              </div>
            </div>
            
            <div class="detail-recommendations">
              <h5><i class="fas fa-lightbulb"></i> AI Recommendations</h5>
              <div class="recommendations-list" id="aiRecommendations">
                <!-- Recommendations will be populated dynamically -->
              </div>
            </div>
          </div>
        </div>



        <!-- Progress and Status Panel -->
        <div class="progress-panel" id="progressPanel" style="display: none;">
          <div class="progress-header">
            <h4><i class="fas fa-cog fa-spin"></i> Analysis Progress</h4>
            <span class="progress-status" id="progressStatus">Initializing...</span>
          </div>

          <div class="progress-bar-container">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <span class="progress-text" id="progressText">0%</span>
          </div>

          <div class="progress-details">
            <div class="detail-item">
              <span class="detail-label">Current Step:</span>
              <span class="detail-value" id="currentStep">Initializing</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Time Elapsed:</span>
              <span class="detail-value" id="timeElapsed">0:00</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Overlaps Found:</span>
              <span class="detail-value" id="overlapsFound">0</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Feature 3: Multi-Track Audio Handling -->
      <section class="feature-content" id="feature3">
        <div class="feature-header">
          <h3>Multi-Track Audio Handling</h3>
          <p>Up to 6 tracks + AudioWorklet + Submix routing</p>
        </div>

        <div class="track-limit-info">
          <div class="track-counter">
            <span class="track-count-current" id="currentTrackCount">0</span>
            <span class="track-count-separator">/</span>
            <span class="track-count-max">6</span>
            <span class="track-count-label">Audio Tracks</span>
          </div>
          <div class="submix-indicator">
            <i class="fas fa-project-diagram"></i>
            <span>Submix Routing Active</span>
          </div>
        </div>

        <div class="feature-controls">
          <div class="multi-track-operations">
            <label>Operations (All Tracks):</label>
            <div class="operation-buttons">
              <button class="operation-btn" id="multiSilenceDetect">
                <i class="fas fa-volume-mute"></i> Silence Detection
              </button>
              <button class="operation-btn" id="multiAutoTrim">
                <i class="fas fa-cut"></i> Auto-Trimming
              </button>
              <button class="operation-btn" id="multiOverlapDetect">
                <i class="fas fa-layer-group"></i> Overlap Detection
              </button>
              <button class="operation-btn" id="dynamicDucking">
                <i class="fas fa-volume-down"></i> Dynamic Ducking
              </button>
            </div>
          </div>

          <div class="multicam-support">
            <label class="checkbox-option">
              <input type="checkbox" id="enableMulticam">
              <span class="checkmark"></span>
              Enable Multi-cam Audio Alignment (Manual Setup Required)
            </label>
          </div>
        </div>

        <div class="track-visualization" id="trackVisualization">
          <div class="tracks-header">
            <h4>Track Status & Routing</h4>
            <div class="demo-track-controls">
              <button class="demo-btn" onclick="window.audioToolsPro.addDemoTrack('speech')">
                <i class="fas fa-microphone"></i> Add Speech Track
              </button>
              <button class="demo-btn" onclick="window.audioToolsPro.addDemoTrack('music')">
                <i class="fas fa-music"></i> Add Music Track
              </button>
              <button class="demo-btn" onclick="window.audioToolsPro.addDemoTrack('effects')">
                <i class="fas fa-volume-up"></i> Add Effects Track
              </button>
            </div>
          </div>
          <div class="tracks-container" id="tracksContainer">
            <!-- Tracks will be populated dynamically -->
          </div>
        </div>
      </section>

      <!-- Feature 4: Rhythm & Timing Correction -->
      <section class="feature-content" id="feature4">
        <div class="feature-header">
          <h3>Rhythm & Timing Correction</h3>
          <p>Phase Vocoder + GPT-4 Analysis + Sample-accurate timing</p>
        </div>

        <div class="feature-controls">
          <div class="control-row">
            <div class="control-group">
              <label for="timingTolerance">Timing Tolerance</label>
              <div class="slider-control">
                <input type="range" id="timingTolerance" min="50" max="300" value="150" step="10">
                <span class="slider-value" id="timingToleranceValue">±150ms</span>
              </div>
            </div>
            <div class="control-group">
              <label for="stretchAlgorithm">Time-Stretch Algorithm</label>
              <select id="stretchAlgorithm" class="select-input">
                <option value="phase_vocoder">Phase Vocoder (No Pitch Change)</option>
                <option value="granular">Granular Synthesis</option>
                <option value="wsola">WSOLA</option>
              </select>
            </div>
          </div>

          <div class="ai-analysis-options">
            <label>GPT-4 Conversational Analysis:</label>
            <div class="ai-checkboxes">
              <label class="checkbox-option">
                <input type="checkbox" id="enableGPTAnalysis">
                <span class="checkmark"></span>
                Optimal Cut Point Detection
              </label>
              <label class="checkbox-option">
                <input type="checkbox" id="enableFlowAnalysis">
                <span class="checkmark"></span>
                Conversational Flow Analysis
              </label>
            </div>
          </div>
        </div>

        <div class="feature-actions">
          <button class="action-btn primary" id="analyzeRhythm">
            <i class="fas fa-chart-line"></i> Analyze Rhythm
          </button>
          <button class="action-btn secondary" id="correctTiming" disabled>
            <i class="fas fa-magic"></i> Apply Corrections
          </button>
          <button class="action-btn secondary" id="previewCorrections" disabled>
            <i class="fas fa-play"></i> Preview Changes
          </button>
        </div>

        <div class="rhythm-analysis" id="rhythmAnalysis">
          <div class="empty-state">
            <i class="fas fa-music"></i>
            <p>Analyze rhythm to see timing patterns and correction suggestions</p>
          </div>
        </div>
      </section>

      <!-- Feature 5: Settings Panel -->
      <section class="feature-content" id="feature5">
        <div class="feature-header">
          <h3>Settings & Configuration</h3>
          <p>CEP SharedData + Real-time preview + Export/Import</p>
        </div>

        <div class="settings-sections">

          <!-- API Configuration -->
          <div class="settings-section">
            <h4><i class="fas fa-key"></i> API Configuration</h4>
            <div class="api-settings">
              <div class="api-group">
                <label for="openaiApiKey">OpenAI API Key (Whisper + GPT-4)</label>
                <div class="api-input-group">
                  <input type="password" id="openaiApiKey" class="api-input" placeholder="sk-...">
                  <button class="test-btn" id="testOpenAI">Test</button>
                </div>
                <div class="api-status" id="openaiStatus">
                  <span class="status-badge">Not configured</span>
                </div>
              </div>

              <div class="api-group">
                <label for="googleApiKey">Google Cloud API Key (Speech-to-Text)</label>
                <div class="api-input-group">
                  <input type="password" id="googleApiKey" class="api-input" placeholder="AIza...">
                  <button class="test-btn" id="testGoogle">Test</button>
                </div>
                <div class="api-status" id="googleStatus">
                  <span class="status-badge">Not configured</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Processing Settings -->
          <div class="settings-section">
            <h4><i class="fas fa-microchip"></i> Processing Settings</h4>
            <div class="processing-settings">
              <div class="setting-group">
                <label for="audioBufferSize">Audio Buffer Size</label>
                <select id="audioBufferSize" class="select-input">
                  <option value="256">256 samples (Low Latency)</option>
                  <option value="512" selected>512 samples (Balanced)</option>
                  <option value="1024">1024 samples (High Quality)</option>
                </select>
              </div>
              <div class="setting-group">
                <label for="processingQuality">Processing Quality</label>
                <select id="processingQuality" class="select-input">
                  <option value="draft">Draft (Fast)</option>
                  <option value="standard" selected>Standard</option>
                  <option value="high">High Quality (Slow)</option>
                </select>
              </div>
            </div>
          </div>

          <!-- External Tools -->
          <div class="settings-section">
            <h4><i class="fas fa-tools"></i> External Tools</h4>
            <div class="processing-settings">
              <div class="setting-group">
                <label for="ffmpegPath">FFmpeg Path</label>
                <div class="api-input-group">
                  <input type="text" id="ffmpegPath" class="api-input" placeholder="/opt/homebrew/bin/ffmpeg">
                  <button class="test-btn" id="detectFFmpeg">Detect</button>
                  <button class="test-btn" id="testFFmpeg">Test</button>
                </div>
                <div class="api-status" id="ffmpegStatus">
                  <span class="status-badge">Not configured</span>
                </div>
              </div>
              <div class="setting-group">
                <label class="checkbox-option">
                  <input type="checkbox" id="useCEPProcess">
                  <span class="checkmark"></span>
                  Allow CEP process fallback (not recommended)
                </label>
              </div>
            </div>
          </div>

          <!-- Real-time Preview -->
          <div class="settings-section">
            <h4><i class="fas fa-eye"></i> Real-time Preview</h4>
            <div class="preview-settings">
              <label class="checkbox-option">
                <input type="checkbox" id="enableRealtimePreview" checked>
                <span class="checkmark"></span>
                Enable real-time audio processing preview
              </label>
              <label class="checkbox-option">
                <input type="checkbox" id="enableVisualFeedback" checked>
                <span class="checkmark"></span>
                Show visual feedback during processing
              </label>
            </div>
          </div>

          <!-- Export/Import -->
          <div class="settings-section">
            <h4><i class="fas fa-exchange-alt"></i> Configuration Management</h4>
            <div class="config-actions">
              <button class="action-btn secondary" id="exportConfig">
                <i class="fas fa-download"></i> Export Settings
              </button>
              <button class="action-btn secondary" id="importConfig">
                <i class="fas fa-upload"></i> Import Settings
              </button>
              <button class="action-btn danger" id="resetConfig">
                <i class="fas fa-undo"></i> Reset to Defaults
              </button>
            </div>
          </div>

        </div>
      </section>

    </main>

    <!-- Enhanced Footer -->
    <footer class="footer">
      <div class="progress-section">
        <div class="progress-info">
          <span class="progress-text" id="progressText">Ready</span>
          <span class="progress-detail" id="progressDetail"></span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressBar" style="width: 0%"></div>
        </div>
      </div>
      <div class="footer-info">
        <span class="version-info">Phase 1 | CEP 12 | Node.js</span>
      </div>
    </footer>

    <!-- Enhanced Logs Panel -->
    <div class="logs-panel" id="logsPanel">
      <div class="logs-header">
        <div class="logs-title">
          <h3><i class="fas fa-terminal"></i> Debug Console</h3>
          <span class="logs-count" id="logsCount">0 entries</span>
        </div>
        <div class="logs-controls">
          <button class="logs-control-btn" id="copyLogs" title="Copy logs to clipboard">
            <i class="fas fa-copy"></i>
          </button>
          <button class="logs-control-btn" id="clearLogs" title="Clear logs">
            <i class="fas fa-trash"></i>
          </button>
          <button class="logs-control-btn" id="downloadLogs" title="Download logs">
            <i class="fas fa-download"></i>
          </button>
          <button class="logs-control-btn" id="collapseLogs" title="Hide logs">
            <i class="fas fa-chevron-down"></i>
          </button>
        </div>
      </div>
      <div class="logs-content" id="logsContent">
        <div class="log-entry info">
          <span class="log-time">[00:00:00]</span>
          <span class="log-message">Media Tools Pro initialized - Phase 1 ready</span>
        </div>
      </div>
    </div>
  </div>

  <script src="index.js"></script>
  <script src="enhanced-ui-browser-integration.js"></script>
</body>

</html>